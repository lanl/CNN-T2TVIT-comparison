[//]: <> (THIS IS A MARKDOWN FILE, VIEW IN A MARKDOWN VIEWER OR CONVERT)

# Comparing the Accuracy and Training Paradigms of Convolutional Neural Networks and Tokens-to-Token Vision Transformers

This directory contains code associated with *Comparing the Accuracy and Training Paradigms of Convolutional Neural Networks and Tokens-to-Token Vision Transformers*, as submitted to the [Minitrack on Trustworthy Artificial Intelligence and Machine Learning](https://sites.google.com/view/cfp-hicss-trustworthy-ai/home?authuser=0) at the [2025 Hawaii International Conference on System Sciences (HICSS)](https://hicss.hawaii.edu/).

This code was developed by **Skylar Callis** while working as a post-bachelors student at [Los Alamos National Laboratory (LANL)](https://www.lanl.gov/?source=globalheader) from 2022 - 2024. To see what they are up to these days, visit [Skylar's Website ](https://skylar-jean.com).

This code has been approved by LANL for a BSD-3 open source license under O#4749.

The GitHub page for this code can be found at [here](https://github.com/lanl/CNN-T2TViT-comparison).

## Contents

All of the code for defining and training the machine learning models included herein uses the Python [PyTorch](https://pytorch.org/) package for machine learning.

### Modules

`modules` contains files that define various components of model training. This includes defining the machine learning models themselves, defining the PyTorch `dataset` for the nested cylinder image-regression learning problem, and defining functions to train individual steps and epochs within the PyTorch framework.

### Tests

`tests` contain tests for all of the files in `modules`. Testing is supported by [PyTest](https://docs.pytest.org/en/8.2.x/).

To run tests, call:

`pytest`

To print test coverage, [Pytest-Cov](https://pytest-cov.readthedocs.io/en/latest/readme.html) must be installed. To run coverage, call:

`pytest --cov` to run tests and calculate coverage

`pytest --cov --cov-report term-missing` to show which lines are missing in coverage

### Data

`data` contains example `.npz` data files, a filelist of all example files, and the nested cylinder design file.

This is only a subset of the larger nested cylinder dataset used for model training. However, it is sufficient to run toy versions of the included code. All included models are trained on the density `rho` field of the `.npz` files.

The filelist was generated by running:

`python makefilelists.py --save_dir ../data --input_dir ../data/ --train_split 1.0 --validation_split 0.0 --test_split 0.0`

The design file is used to match a nested cylinder data point to its corresponding scalar prediction. The scalar prediction is a scale value applied to the Preston-Tonks-Wallace (PTW) strength model used in the simulation to generate the input density field.

### CNN Models & T2T-ViT Models

The `CNN_Models` and `T2T_ViT_Models` directories contain the code to train their respective model types, as well as the results from 15 instances of each model. The `train_MODEL.py` files desribe the training routine for a given model type. The `START_study.py` files initiate slurm job submission to train models, supported by `training_START.slurm`, `training_slurm.tmpl`, `training_START.input`, and `training_input.tmpl`. The `hyperparameters.csv` files describe all of the instances of a model type. Model instances are defined by a Study ID (SID). All 100 level SIDs are instances of T2T-ViT models, while all 200 level SIDs are instances of CNNs.

To initiate the training of a model, enter into that model's directory and modify the `hyperparameters.csv` file to reflect the new study. Lines can be commented out in `hyperparametrs.csv` with the `#` character. Commented lines will be ignored when the study is initiated. To start the study, call `python START_study.py --csv hyperparameters.csv`. Results will then be saved to `study_SID` within the model directory.

Each of the study directories include the `studySID_START.slurm`, `training_slurm.tmpl`, `studySID_START.input`, and `training_input.tmpl` files which specify training and model parameters. Additionally, the directoriews include `studySID_epoch*.out` files, which show the prints to terminal during a training process. These include the training and validation loss at each epoch. Only the final `studySID_epoch*.err` file is included, as errors are necessarily not present for earlier epochs. For sucessful studies, the `.err` file is empty. Finally, the study directories contain the `studySID_trainval_summary.csv`, `studySID_testset_results.csv`, and `studySID_bestCHKPT_testset_results.csv`. The `trainval_summary` contains epoch summary information, including training and validation loss and time to complete. Both the `testset_results` files include the model predictions on the full test set, either at the end of training or at the best checkpoint.

### Scripts

`scripts` contains processing scripts for data and trained models. `makefilelists.py` generates file lists for model training, validation, and testing given a directory of data. `clean_study_dir.py` deletes unnecessary files from a completed study directory. `best_chkpoint_testing.py` evaluates all saved model checkpoints on the test set to determine which has the best performance. This is particularlly useful for CNNs exhibiting overfitting, as earlier model checkpoints may have better performance than the final model instance.

### Notebooks

`notebooks` contains Jupyter notebooks that generate plots. `plot_nestedcyl_data.ipynb` shows example nested cylinder density fields. `model_results.ipynb` shows the training and validation loss history for the models, as well as computes other metrics for model comparison.

### Figures

`figures` contains model diagrams, example nested cylinder density fields, and model result figures. Many of the figures are generated by the included Jupyter notebooks.

